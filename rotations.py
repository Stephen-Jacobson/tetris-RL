#precompute rotations as to avoid any extra logic and make O(1) time
I_ROT = [
    [
        [" ", " ", " ", " "],
        ["X", "X", "X", "X"],
        [" ", " ", " ", " "],
        [" ", " ", " ", " "],
    ],
    [
        [" ", " ", "X", " "],
        [" ", " ", "X", " "],
        [" ", " ", "X", " "],
        [" ", " ", "X", " "],
    ],
    [
        [" ", " ", " ", " "],
        [" ", " ", " ", " "],
        ["X", "X", "X", "X"],
        [" ", " ", " ", " "],
    ],
    [
        [" ", "X", " ", " "],
        [" ", "X", " ", " "],
        [" ", "X", " ", " "],
        [" ", "X", " ", " "],
    ],
]
O_ROT = [
    [
        [" ", "X", "X", " "],
        [" ", "X", "X", " "],
        [" ", " ", " ", " "],
    ]
]

T_ROT = [
    [
        [" ", "X", " "],
        ["X", "X", "X"],
        [" ", " ", " "],
    ],
    [
        [" ", "X", " "],
        [" ", "X", "X"],
        [" ", "X", " "],
    ],
    [
        [" ", " ", " "],
        ["X", "X", "X"],
        [" ", "X", " "],
    ],
    [
        [" ", "X", " "],
        ["X", "X", " "],
        [" ", "X", " "],
    ],
]
S_ROT = [
    [
        [" ", "X", "X"],
        ["X", "X", " "],
        [" ", " ", " "],
    ],
    [
        [" ", "X", " "],
        [" ", "X", "X"],
        [" ", " ", "X"],
    ],
    [
        [" ", " ", " "],
        [" ", "X", "X"],
        ["X", "X", " "],
    ],
    [
        ["X", " ", " "],
        ["X", "X", " "],
        [" ", "X", " "],
    ],
]
Z_ROT = [
    [
        ["X", "X", " "],
        [" ", "X", "X"],
        [" ", " ", " "],
    ],
    [
        [" ", " ", "X"],
        [" ", "X", "X"],
        [" ", "X", " "],
    ],
    [
        [" ", " ", " "],
        ["X", "X", " "],
        [" ", "X", "X"],
    ],
    [
        [" ", "X", " "],
        ["X", "X", " "],
        ["X", " ", " "],
    ],
]
J_ROT = [
    [
        ["X", " ", " "],
        ["X", "X", "X"],
        [" ", " ", " "],
    ],
    [
        [" ", "X", "X"],
        [" ", "X", " "],
        [" ", "X", " "],
    ],
    [
        [" ", " ", " "],
        ["X", "X", "X"],
        [" ", " ", "X"],
    ],
    [
        [" ", "X", " "],
        [" ", "X", " "],
        ["X", "X", " "],
    ],
]
L_ROT = [
    [
        [" ", " ", "X"],
        ["X", "X", "X"],
        [" ", " ", " "],
    ],
    [
        [" ", "X", " "],
        [" ", "X", " "],
        [" ", "X", "X"],
    ],
    [
        [" ", " ", " "],
        ["X", "X", "X"],
        ["X", " ", " "],
    ],
    [
        ["X", "X", " "],
        [" ", "X", " "],
        [" ", "X", " "],
    ],
]

ROTATIONS = {
    1: I_ROT,
    2: O_ROT,
    3: T_ROT,
    4: S_ROT,
    5: Z_ROT,
    6: J_ROT,
    7: L_ROT,
}

PIECES = {                                          #"i", "o", "t", "s", "z", "j", "l"
    1: {  # 4x4 local box
        0: [(1,0),(1,1),(1,2),(1,3)],  # horizontal
        1: [(0,2),(1,2),(2,2),(3,2)],  # vertical
        2: [(2,0),(2,1),(2,2),(2,3)],  # horizontal flipped
        3: [(0,1),(1,1),(2,1),(3,1)],  # vertical flipped
    },
    2: {  # 4x4 local box, rotation-invariant
        0: [(0,1),(0,2),(1,1),(1,2)],
        1: [(0,1),(0,2),(1,1),(1,2)],
        2: [(0,1),(0,2),(1,1),(1,2)],
        3: [(0,1),(0,2),(1,1),(1,2)],
    },
    3: {
        0: [(0,1),(1,0),(1,1),(1,2)],
        1: [(0,1),(1,1),(1,2),(2,1)],
        2: [(1,0),(1,1),(1,2),(2,1)],
        3: [(0,1),(1,0),(1,1),(2,1)],
    },
    4: {
        0: [(0,1),(0,2),(1,0),(1,1)],
        1: [(0,1),(1,1),(1,2),(2,2)],
        2: [(1,1),(1,2),(2,0),(2,1)],
        3: [(0,0),(1,0),(1,1),(2,1)],
    },
    5: {
        0: [(0,0),(0,1),(1,1),(1,2)],
        1: [(0,2),(1,1),(1,2),(2,1)],
        2: [(1,0),(1,1),(2,1),(2,2)],
        3: [(0,1),(1,0),(1,1),(2,0)],
    },
    6: {
        0: [(0,0),(1,0),(1,1),(1,2)],
        1: [(0,1),(0,2),(1,1),(2,1)],
        2: [(1,0),(1,1),(1,2),(2,2)],
        3: [(0,1),(1,1),(2,0),(2,1)],
    },
    7: {
        0: [(0,2),(1,0),(1,1),(1,2)],
        1: [(0,1),(1,1),(2,1),(2,2)],
        2: [(1,0),(1,1),(1,2),(2,0)],
        3: [(0,0),(0,1),(1,1),(2,1)],
    }
}

# J, L, S, T, Z (SRS) wall kicks, with (row,col) = (-y, x)
WALL_KICKS = {
    1: [(0, 0), (0, -1), (-1, -1), (2, 0), (2, -1)],   # 0->R
    2: [(0, 0), (0,  1), (1,  1), (-2, 0), (-2, 1)],   # R->0
    3: [(0, 0), (0,  1), (1,  1), (-2, 0), (-2, 1)],   # R->2
    4: [(0, 0), (0, -1), (-1, -1), (2, 0), (2, -1)],   # 2->R
    5: [(0, 0), (0,  1), (-1, 1), (2, 0), (2, 1)],     # 2->L
    6: [(0, 0), (0, -1), (1, -1), (-2, 0), (-2, -1)],  # L->2
    7: [(0, 0), (0, -1), (1, -1), (-2, 0), (-2, -1)],  # L->0
    8: [(0, 0), (0,  1), (-1, 1), (2, 0), (2, 1)],     # 0->L
}

# I tetromino wall kicks (SRS I), same mapping (row,col) = (-y, x)
WALL_KICKS_I = {
    1: [(0, 0), (0, -2), (0, 1), (1, -2), (-2, 1)],    # 0->R
    2: [(0, 0), (0,  2), (0, -1), (-1, 2), (2, -1)],   # R->0
    3: [(0, 0), (0, -1), (0,  2), (-2, -1), (1, 2)],   # R->2
    4: [(0, 0), (0,  1), (0, -2), (2, 1), (-1, -2)],   # 2->R
    5: [(0, 0), (0,  2), (0, -1), (-1, 2), (2, -1)],   # 2->L
    6: [(0, 0), (0, -2), (0,  1), (1, -2), (-2, 1)],   # L->2
    7: [(0, 0), (0,  1), (0, -2), (2, 1), (-1, -2)],   # L->0
    8: [(0, 0), (0, -1), (0,  2), (-2, -1), (1, 2)],   # 0->L
}